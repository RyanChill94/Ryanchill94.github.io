<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DAY DREAM</title>
  
  <subtitle>go big or go home</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-10-21T17:00:50.941Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Ryanchill</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[è¯‘]5ä¸ªåœ¨ES6ä¸­è¢«ä¿®å¤çš„Javascriptç¼ºé™·</title>
    <link href="http://yoursite.com/2018/09/30/five-bad-parts-fix-in-es6/"/>
    <id>http://yoursite.com/2018/09/30/five-bad-parts-fix-in-es6/</id>
    <published>2018-09-30T09:06:51.000Z</published>
    <updated>2018-10-21T17:00:50.941Z</updated>
    
    <content type="html"><![CDATA[<p>ECMAScript 6 çš„ç‰¹æ€§å¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹</p><ul><li><ol><li>çº¯è¯­æ³•ç³–ï¼Œæ¯”å¦‚ <code>class</code> è¯­æ³•</li></ol></li><li><ol start="2"><li>JavaScript å¢å¼ºæ€§  åŠŸèƒ½ï¼Œæ¯”å¦‚ <code>import</code></li></ol></li><li><ol start="3"><li>ä¿®å¤äº† JS ä¸­ä¸€äº›ç¼ºé™·ï¼Œæ¯”å¦‚ <code>let</code> å…³é”®å­—</li></ol></li></ul><p>æœ¬æ–‡ç€é‡åˆ†æç¬¬ä¸‰ç§ç±»å‹ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸‹ JavaScript ä¸­å“ªäº›ã€ŒBad Partsã€è¢« ES6 ä¿®å¤äº†ã€‚</p><blockquote><p> æˆ‘å¸Œæœ›å½“ä½ é˜…è¯»å®Œæœ¬æ–‡ï¼Œä½ å¯ä»¥æ„è¯†åˆ°ä½¿ç”¨ä¸€äº›ç®€å• ES6 ç‰¹æ€§ç»™ä½ å¸¦æ¥çš„å·¨å¤§ä¾¿åˆ©ã€‚</p></blockquote><h3 id="1-Block-Scope"><a href="#1-Block-Scope" class="headerlink" title="1. Block Scope"></a>1. Block Scope</h3><p>ES5 åªæœ‰å‡½æ•°ä½œç”¨åŸŸ(æ¯”å¦‚ä½ å®šä¹‰åœ¨å‡½æ•°å—é‡Œé¢çš„ä»£ç æ¥å½¢æˆä½œç”¨åŸŸ),å› æ­¤å¸¦æ¥äº†å¾ˆå¤šé—®é¢˜, ES6  æä¾›äº†ã€Œå—çº§åˆ«ã€çš„ä½œç”¨åŸŸï¼ˆé€šè¿‡å¤§æ‹¬å·åŒ…è£¹ï¼‰ï¼ŒåŒæ—¶ä½¿ç”¨ <code>let</code>  å’Œ <code>const</code> æ¥ä»£æ›¿ <code>var</code>ã€‚</p><h4 id="é˜²æ­¢å˜é‡æå‡åˆ°å¤–éƒ¨ä½œç”¨åŸŸ"><a href="#é˜²æ­¢å˜é‡æå‡åˆ°å¤–éƒ¨ä½œç”¨åŸŸ" class="headerlink" title="é˜²æ­¢å˜é‡æå‡åˆ°å¤–éƒ¨ä½œç”¨åŸŸ"></a>é˜²æ­¢å˜é‡æå‡åˆ°å¤–éƒ¨ä½œç”¨åŸŸ</h4><p>ä¸‹é¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ å˜é‡ <code>bouns</code>æ²¡æœ‰è¢«æå‡åˆ° <code>if</code> å—çº§ä½œç”¨åŸŸä¹‹å¤– ï¼Œ å˜å¾—å…¶ä»–åƒå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€é‚£æ ·å¯é¢„æµ‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> base = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bonus = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSalary</span>(<span class="params">addBonus</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (addBonus) &#123;</span><br><span class="line">    <span class="keyword">var</span> bonus = <span class="number">100</span>; <span class="comment">// ä¼šè¢«æå‡è‡³ifä½œç”¨åŸŸä¹‹å¤–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base + bonus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> base + bonus;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getSalary(<span class="literal">false</span>)); <span class="comment">// NaN å› ä¸ºå˜é‡ bonus è¢«æå‡äº†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getSalary(<span class="literal">true</span>)); <span class="comment">// 1100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> base = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bonus = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSalary</span>(<span class="params">addBonus</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (addBonus) &#123;</span><br><span class="line">    <span class="keyword">let</span> bonus = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base + bonus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> base + bonus;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getSalary(<span class="literal">false</span>)); <span class="comment">// 1000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getSalary(<span class="literal">true</span>)); <span class="comment">// 1100</span></span><br></pre></td></tr></table></figure><h4 id="é˜²æ­¢é‡å¤å®šä¹‰å˜é‡"><a href="#é˜²æ­¢é‡å¤å®šä¹‰å˜é‡" class="headerlink" title="é˜²æ­¢é‡å¤å®šä¹‰å˜é‡"></a>é˜²æ­¢é‡å¤å®šä¹‰å˜é‡</h4><p>ES6 ä¸å…è®¸ä½¿ç”¨<code>let</code>æˆ–è€…<code>const</code>å®šä¹‰çš„å˜é‡åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­é‡å¤å®šä¹‰ï¼Œè¿™æœ‰æ•ˆçš„é¿å…äº†ä¸åŒåº“ä¹‹é—´çš„å‡½æ•°è¡¨è¾¾å¼çš„é‡å¤ï¼ˆæ³¨ï¼šè¿™é‡Œç¿»è¯‘æœ‰ç‚¹é—®é¢˜ï¼ŒåŸæ–‡ä¸º:This is very helpful in avoiding duplicate function expressions coming from different libraries ï¼‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span>  add  = <span class="function">(<span class="params">a, b</span>) =&gt;</span>  a  +  b;</span><br><span class="line"><span class="keyword">const</span>  add  = <span class="function">(<span class="params">a, b</span>) =&gt;</span>  a  +  b; <span class="comment">// ä¼šæŠ›å‡ºé‡å¤å®šä¹‰é”™è¯¯</span></span><br></pre></td></tr></table></figure><h4 id="å–ä»£-IIFE-çš„åŠŸèƒ½"><a href="#å–ä»£-IIFE-çš„åŠŸèƒ½" class="headerlink" title=" å–ä»£ IIFE çš„åŠŸèƒ½"></a> å–ä»£ IIFE çš„åŠŸèƒ½</h4><p>åœ¨ ES5ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­ï¼Œ æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°(IIFE)æ¥ç¡®ä¿å…¨å±€ä½œç”¨åŸŸä¸ä¼šè¢«æ±¡æŸ“ï¼Œåœ¨ ES6 ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„æŠŠä»£ç åŒ…è£¹åœ¨<code>{}</code>ä¸­,ä½¿ç”¨ <code>let</code> å’Œ <code>const</code>  æ¥å®šä¹‰å˜é‡å°±å¯ä»¥è·å¾—ç›¸åŒçš„æ•ˆæœã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.betterJQ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Version <span class="subst">$&#123;<span class="built_in">window</span>.bettterJQ.version&#125;</span> already exists`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> version = <span class="string">"v0.0.1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">"Better JQuery"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> betterJQ = &#123;</span><br><span class="line">      name,</span><br><span class="line"></span><br><span class="line">      version,</span><br><span class="line"></span><br><span class="line">      ajax: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="string">"requst!"</span>;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.betterJQ = betterJQ; <span class="comment">// æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Š</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.betterJQ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Version <span class="subst">$&#123;<span class="built_in">window</span>.bettterJQ.version&#125;</span> already exists`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> version = <span class="string">"v0.0.1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">"Better JQuery"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> betterJQ = &#123;</span><br><span class="line">      name,</span><br><span class="line"></span><br><span class="line">      version,</span><br><span class="line"></span><br><span class="line">      ajax: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="string">"requst!"</span>;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.betterJQ = betterJQ; <span class="comment">// æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Š</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(version); <span class="comment">// Reference Error</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Reference Error</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(betterJQ.version); <span class="comment">// v0.0.1</span></span><br></pre></td></tr></table></figure><p>babel å¹²äº†ä»€ä¹ˆï¼Ÿ</p><p>babel ä¼šå°†æˆ‘ä»¬çš„ä»£ç ç¼–è¯‘æˆå¦‚ä¸‹å½¢å¼:</p><p><img src="/img/postImg/babel-transfer.png" alt="bebel è½¬æ¢"></p><h4 id="è®©åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°å˜å¾—è½»è€Œæ˜“ä¸¾"><a href="#è®©åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°å˜å¾—è½»è€Œæ˜“ä¸¾" class="headerlink" title="è®©åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°å˜å¾—è½»è€Œæ˜“ä¸¾"></a>è®©åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°å˜å¾—è½»è€Œæ˜“ä¸¾</h4><p>åœ¨ ES5, å¦‚æœä½ æœ‰ä¸€ä¸ªå‡½æ•°  åœ¨å¾ªç¯ä¸­ï¼Œå½¢  å¦‚<code>for(var i = 0; i &lt; 3; i++) {â€¦}</code>,å¦‚æœä½ çš„å‡½æ•°éœ€è¦ä½¿ç”¨å˜é‡ï¼Œç”±äºå˜é‡æå‡çš„ç¼˜æ•…ï¼Œå¯èƒ½ä¼šå’Œ  é¢„æœŸä¸ä¸€æ ·ï¼Œå¦‚æœä½¿ç”¨<code>let</code>, ä½ å°†ä¸ä¼šé‡åˆ°ä»»ä½•éº»çƒ¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i; <span class="comment">// åŒä¸€ä¸ªrefer</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[j]()); <span class="comment">// 3, 3, 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  arr.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i; <span class="comment">// refer åˆ°å½“å‰å—çº§ä½œç”¨åŸŸçš„i</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arr[j]()); <span class="comment">// 0, 1, 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Note: ä¸èƒ½ä½¿ç”¨<code>const</code>ï¼Œå› ä¸ºå®ƒæ˜¯å¸¸é‡ã€‚é™¤éä½ ä½¿ç”¨æ–°<code>for...of</code>å¾ªç¯</p></blockquote><h3 id="2-è¯æ³•thisï¼ˆé€šè¿‡ç®­å¤´å‡½æ•°ï¼‰"><a href="#2-è¯æ³•thisï¼ˆé€šè¿‡ç®­å¤´å‡½æ•°ï¼‰" class="headerlink" title="2. è¯æ³•thisï¼ˆé€šè¿‡ç®­å¤´å‡½æ•°ï¼‰"></a>2. è¯æ³•<code>this</code>ï¼ˆé€šè¿‡ç®­å¤´å‡½æ•°ï¼‰</h3><p>åœ¨ ES5 ä¸­,<code>this</code> å¯ä»¥å–å†³äºä½ åœ¨å“ªé‡Œè°ƒç”¨ã€ ä½ æ€ä¹ˆè°ƒç”¨ï¼Œå› è€Œå¯¼è‡´äº† JS å¼€å‘è€…æ— æ•°çš„çƒ¦æ¼ï¼ŒES6 é€šè¿‡è¯æ³•<code>this</code> æ¶ˆé™¤äº†è¿™ä¸ªä¸»è¦é—®é¢˜ã€‚</p><p>è¯æ³•<code>this</code>æ˜¯ä¸€ä¸ªè¿™æ ·çš„ç‰¹æ€§ï¼š  å³å¼ºåˆ¶è¦æ±‚å˜é‡<code>this</code>å¤©ç„¶æŒ‡å‘å½“å‰å®šä¹‰çš„å¯¹è±¡ä¸Šã€‚</p><p>ä¸¤ä¸ªåœ¨ ES5 ä¸­çš„é—®é¢˜ï¼Œä»¥åŠè§£å†³æ–¹æ¡ˆ:</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ç­”æ‰“å° user çš„ firstName å’Œ Salaryï¼Œ ä½†æ˜¯å½“æˆ‘ä»¬æ¨¡æ‹Ÿä»æœåŠ¡ç«¯è·å–  è–ª  é‡‘  æ•°æ®ï¼Œä¼šå‘ç°å½“å“åº”è¿”å›çš„æ—¶å€™ï¼Œ<code>this</code>æŒ‡å‘çš„  æ˜¯ windowï¼Œè€Œä¸æ˜¯ person å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSalaryFromServer</span>(<span class="params">id, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    cb(<span class="number">1000</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  id: <span class="string">"1"</span>,</span><br><span class="line"></span><br><span class="line">  firstName: <span class="string">"chill"</span>,</span><br><span class="line"></span><br><span class="line">  lastName: <span class="string">"ryan"</span>,</span><br><span class="line"></span><br><span class="line">  printNameAndSalary: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id);</span><br><span class="line"></span><br><span class="line">    getSalaryFromServer(<span class="keyword">this</span>.id, <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.firstName); <span class="comment">// underfined</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(salary); <span class="comment">// 1000</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fix 1</span></span><br><span class="line"></span><br><span class="line">    getSalaryFromServer(<span class="keyword">this</span>.id, <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;).bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fix 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    getSalaryFromServer(<span class="keyword">this</span>.id, <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(self.firstName); <span class="comment">// chill</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ES6 çš„è§£å†³æ–¹æ¡ˆ:</p><p>ç®€å•çš„åœ¨ä»£ç ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆ=&gt;ï¼‰ï¼Œä½ å°±å¯ä»¥è‡ªåŠ¨å¾—åˆ°è¯æ³•<code>this</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">person = &#123;</span><br><span class="line">    // ...</span><br><span class="line">    getSalaryFromServer(this.id, (salary) =&gt;&#123;</span><br><span class="line">        console.log(self.firstName) // chill</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>babel æ˜¯å¦‚æœå°†ç®­å¤´å‡½æ•°è½¬æ¢æˆæ™®é€šçš„ ES5 å‡½æ•°è¯­æ³•çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">person = &#123;</span><br><span class="line">  printNameAndSalary: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id);</span><br><span class="line"></span><br><span class="line">    getSalaryFromServer(<span class="keyword">this</span>.id, <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯ä»¥çœ‹åˆ°ï¼Œbabel ä¹Ÿæ˜¯é€šè¿‡æŠŠthisæŒ‡å‘æš‚å­˜åœ¨å¦ä¸€ä¸ªå˜é‡</span></span><br><span class="line">      <span class="built_in">console</span>.log(_this.firstName);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å¤„ç†argumentså˜é‡"><a href="#3-å¤„ç†argumentså˜é‡" class="headerlink" title="3.å¤„ç†argumentså˜é‡"></a>3.å¤„ç†<code>arguments</code>å˜é‡</h3><p>åœ¨ ES5 ä¸­ï¼Œ<code>arguments</code> è¡¨ç°çš„åƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ­£å¸¸çš„å¾ªç¯å®ƒï¼‰ï¼Œä½†æ˜¯å®ƒå´ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤ï¼Œæ‰€æœ‰å‡½æ•°çš„æ–¹æ³•ï¼Œæ¯”å¦‚ sortã€slice ç­‰ç­‰æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨çš„ã€‚</p><p>åœ¨ ES6 é‡Œï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨  rest å‚æ•°çš„  ç‰¹æ€§, å½¢å¦‚<code>...args</code>,rest å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ å› æ­¤æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨  å„ç§æ•°ç»„çš„çš„æ–¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mySort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="keyword">return</span> args.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mySort</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> args.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Classes"><a href="#4-Classes" class="headerlink" title="4. Classes"></a>4. Classes</h3><p>ä»æ¦‚å¿µä¸Šè®²ï¼ŒJS ä¸­å¹¶ä¸å­˜åœ¨åƒå…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆå¦‚ JAVAï¼‰é‚£æ ·çš„ç±»çš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨å¾ˆé•¿æ—¶é—´é‡Œï¼ŒJSå¼€å‘è€…å·²ç»æŠŠå‡½æ•°ï¼ˆä¹Ÿå«åšæ„é€ å‡½æ•°ï¼‰é€šè¿‡ <code>new</code> å…³é”®è¯äº§ç”Ÿçš„å¯¹è±¡ç§°ä¹‹ä¸ºç±»ï¼Œ</p><p>å› ä¸º JS å¹¶ä¸æ”¯æŒç±»ï¼ˆClassï¼‰,ä»…ä»…é€šè¿‡åŸå‹æ¥æ¨¡æ‹Ÿï¼Œå¯¼è‡´ç°æœ‰çš„è¯­æ³•ï¼Œæ— è®ºæ˜¯ç›®å‰æ­£å¸¸ä½¿ç”¨JSçš„å¼€å‘è€…ï¼Œè¿˜æ˜¯æƒ³ç”¨æ˜¯ä½¿ç”¨ä¼ ç»ŸOOè¯­æ³•çš„æ–°å¼€å‘è€…ï¼Œéƒ½ä»¤äººæ„Ÿåˆ°ååˆ†å›°æƒ‘ã€‚åœ¨ä¸€äº›åœºæ™¯å°¤å…¶ä»¤äººæ‘¸ä¸ç€å¤´è„‘ï¼Œè¯¸å¦‚åˆ›é€ å­ç±»ï¼Œè°ƒç”¨çˆ¶çº§æ–¹æ³•ç­‰ç­‰ã€‚</p><p>ES6 å¸¦æ¥å…¨æ–°çš„è¯­æ³•ï¼Œ å°±åƒå¤§å¤šæ•°å¸¸è§çš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œåˆ›å»ºç±»è¿™ä»¶äº‹å˜å¾—åˆ†æˆç®€å•ã€‚ä¸€ä¸‹æ˜¯ES5å’ŒES6ä¸¤å¼ åˆ›å»ºç±»çš„æ–¹æ³•çš„å¯¹æ¯”</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çˆ¶ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Shape = <span class="function"><span class="keyword">function</span>(<span class="params">id, x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.id = id;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.location(x, y);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Shape.prototype.location = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.x = x;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Shape.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Shape + <span class="string">"("</span> + <span class="keyword">this</span>.id + <span class="string">")"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Shape.prototype.getLocation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    x: <span class="keyword">this</span>.x,</span><br><span class="line"></span><br><span class="line">    y: <span class="keyword">this</span>.y</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Circle = <span class="function"><span class="keyword">function</span>(<span class="params">id, x, y, radius</span>) </span>&#123;</span><br><span class="line">  Shape.call(<span class="keyword">this</span>, id, x, y);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.radius = radius;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤ç§æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">Circle.prototype = <span class="built_in">Object</span>.create(Shape.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line">Circle.prototype = <span class="keyword">new</span> Shape();</span><br><span class="line"></span><br><span class="line">Circle.prototype.constructor = Circle;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">Circle.defaultCircle = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Circle(<span class="string">"default"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Circle.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"Circle &gt;"</span> + Shape.ptototype.toString.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(id, x, y) &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.location(x, y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location(x, y) &#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`shape :id = <span class="subst">$&#123;<span class="keyword">this</span>.id&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getLocaton() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      x: <span class="keyword">this</span>.x,</span><br><span class="line"></span><br><span class="line">      y: <span class="keyword">this</span>.y</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span>() </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(id, x, y, radius) &#123;</span><br><span class="line">    <span class="keyword">super</span>(id, x, y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.radius = radius;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> getDefaultCircle() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Circle(<span class="string">"defalut"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Circle &gt;"</span> + <span class="keyword">super</span>.toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UPDATE</strong>: ç¡®ä¿ä½ ä½ å·²ç»é˜…è¯»äº†ï¼š <a href="https://medium.com/@rajaraodv/is-class-in-es6-the-new-bad-part-6c4e6fe1ee65" target="_blank" rel="noopener">ES6çš„ä¸­çš„<code>Class</code>è¯­æ³•æ˜¯æ–°çš„ç³Ÿç²•å—?</a></p><h3 id="5-ä¸¥æ ¼æ¨¡å¼"><a href="#5-ä¸¥æ ¼æ¨¡å¼" class="headerlink" title="5. ä¸¥æ ¼æ¨¡å¼"></a>5. ä¸¥æ ¼æ¨¡å¼</h3><p>ä¸¥æ ¼æ¨¡å¼ï¼ˆâ€œuse strictâ€ï¼‰å¸®ç»„å¼€å‘ç”„åˆ«ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼ˆæˆ–è€…è¯´jsä¸­çš„ç¼ºé™·ï¼‰ï¼ŒåŒæ—¶é¿å…JavaScriptçš„æ»¥ç”¨ã€‚åœ¨ES5ï¼Œä¸¥æ ¼æ¨¡å¼æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œä½†æ˜¯åœ¨ES6ï¼Œå®ƒæ˜¯è®¸å¤šES6ç‰¹æ€§æ‰€ä¾èµ–çš„ï¼Œå› æ­¤å¾ˆå¤šå¼€å‘è€…å’Œå·¥å…·åº“ï¼Œæ¯”å¦‚babelï¼Œè‡ªåŠ¨åœ¨æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ äº†<code>â€œuse strictâ€</code>ï¼Œé»˜è®¤å¼€å¯jsçš„ä¸¥æ ¼æ¨¡å¼æ¥å¼ºè¿«æˆ‘ä»¬å†™æ›´å¥½çš„JSä»£ç ã€‚</p><p>ä»¥ä¸ŠğŸ™</p><p><a href="https://medium.freecodecamp.org/mindset-lessons-from-a-year-with-react-1de862421981" target="_blank" rel="noopener">åŸæ–‡è¿æ¥</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ECMAScript 6 çš„ç‰¹æ€§å¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;ol&gt;
&lt;li&gt;çº¯è¯­æ³•ç³–ï¼Œæ¯”å¦‚ &lt;code&gt;class&lt;/code&gt; è¯­æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;JavaScript å¢å¼ºæ€§ 
      
    
    </summary>
    
    
      <category term="vanilla" scheme="http://yoursite.com/tags/vanilla/"/>
    
      <category term="Translation" scheme="http://yoursite.com/tags/Translation/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘]ç†è§£ React v16 æ–°çš„ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="http://yoursite.com/2018/09/20/understand-new-lifecycle-in-React-16/"/>
    <id>http://yoursite.com/2018/09/20/understand-new-lifecycle-in-React-16/</id>
    <published>2018-09-20T13:20:58.000Z</published>
    <updated>2018-10-24T13:41:24.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç†è§£-React-v16-4-çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç†è§£-React-v16-4-çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç†è§£ React v16.4+ çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç†è§£ React v16.4+ çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ</h1><blockquote><p>åŸæ–‡é“¾æ¥:<br><a href="https://blog.bitsrc.io/understanding-react-v16-4-new-component-lifecycle-methods-fa7b224efd7d" target="_blank" rel="noopener">Understanding React v16.4+ New Component Lifecycle Methods</a>ï¼ˆç•¥æœ‰åˆ å‡ï¼‰</p></blockquote><p>ReactJs v16.3 ä¸ºæˆ‘ä»¬å±•ç°äº†æ˜¾è‘—å˜åŒ–çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ŒåºŸå¼ƒäº†ä¸€äº›ç”Ÿå‘½å‘¨æœŸåŒæ—¶å¢åŠ äº†å‡ ä¸ªé¢å¤–çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ·±å…¥ React v16.3+ çš„ç”Ÿå‘½å‘¨æœŸ ï¼Œæˆ‘ä»¬ä¼šç”¨Reactæ„å»ºä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨æ¥è·å¾—å®æˆ˜ç»éªŒã€‚</p><h2 id="React-ä¸-UI"><a href="#React-ä¸-UI" class="headerlink" title="React ä¸ UI"></a>React ä¸ UI</h2><p>React çš„å®˜æ–¹ä»‹ç»ç§°ï¼šâ€˜React æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»º UI çš„ç•Œé¢â€™ã€‚</p><p>ç”¨æˆ·ç•Œé¢æ˜¯ä¸€ä¸ªå¤šé€‰é¡¹åœºæ™¯ï¼Œç”¨æˆ·å¯ä»¥åšå„ç§å„æ ·çš„äº‹æƒ…ï¼Œæƒ³Reactè¿™æ ·çš„ç¬¬ä¸‰åº“å°±æ˜¯ç”¨äºæ„å»ºè¿™ç±»åœºæ™¯çš„ã€‚</p><p>ç”¨æˆ·é€šè¿‡åœ¨ UI ç»„ä»¶ä¸­ç‚¹å‡»ã€æ»‘åŠ¨ã€ç‚¹å‡»æŒ‰é’®ã€æˆ–è€…å…¶ä»–è¡Œä¸ºæ¥äºæˆ‘ä»¬çš„åº”ç”¨äº¤äº’ã€‚ æ‰€æœ‰çš„UIç»„ä»¶åœ¨æµè§ˆå™¨ä¸­è¯ç”Ÿ å¹¶ä¸”åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹ä¼šæ¶ˆå¤±ã€‚</p><h2 id="ä¸ºä»€ä¹ˆç”Ÿå‘½å‘¨æœŸå‡½æ•°å¾ˆé‡è¦"><a href="#ä¸ºä»€ä¹ˆç”Ÿå‘½å‘¨æœŸå‡½æ•°å¾ˆé‡è¦" class="headerlink" title="ä¸ºä»€ä¹ˆç”Ÿå‘½å‘¨æœŸå‡½æ•°å¾ˆé‡è¦?"></a>ä¸ºä»€ä¹ˆç”Ÿå‘½å‘¨æœŸå‡½æ•°å¾ˆé‡è¦?</h2><p>ä¸–é—´ä¸‡ç‰©ï¼Œæ‰€æœ‰çš„äº‹ç‰©éƒ½æœ‰ä¸€ç³»åˆ—çš„äº‹ä»¶é©±åŠ¨ã€‚</p><p>è¯¦è§åŸæ–‡ï¼Œè¿™é‡Œä¸åšç¿»è¯‘ï¼Œå¤§æ„æ˜¯ä½œè€…çš„ä¸€äº›æ„Ÿæ‚Ÿã€‚</p><p>å¦‚æœå¯ä»¥æ„ŸçŸ¥è¿™äº›ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬å°±å¯ä»¥å°±å¯ä»¥æ§åˆ¶æ•´ä¸ªæµå‘ï¼Œæ¯«æ— ç–‘é—®å¯ä»¥å¸®æˆ‘ä»¬äº§å‡ºæ›´å¥½çš„ç»“æœã€‚</p><h2 id="åºŸå¼ƒçš„æ–¹æ³•äºæ–°çš„é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#åºŸå¼ƒçš„æ–¹æ³•äºæ–°çš„é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="åºŸå¼ƒçš„æ–¹æ³•äºæ–°çš„é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>åºŸå¼ƒçš„æ–¹æ³•äºæ–°çš„é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h2><p>åœ¨ React 16.3ä¸­ï¼Œæœ‰å°‘æ•°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¢«åˆ é™¤ã€‚ç›®å‰ï¼Œè¿™äº›æ–¹æ³•éƒ½å¢åŠ äº†ä¸€ä¸ªå‰ç¼€ UNSAFE_ ï¼Œå¹¶å°†åœ¨ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­å®Œå…¨åˆ é™¤ã€‚ åŒæ—¶ï¼Œç°å­˜çš„Reactåº”ç”¨å¯ä»¥å‘æ–°çš„ React ç”Ÿå‘½å‘¨æœŸé€æ¸è¿ç§»ã€‚</p><p>Componentwillmountï¼Œcomponentwillreceiveprobulps å’Œ componentententwillupdate è¿™æ ·çš„æ–¹æ³•è¢«å¤§é‡æ»¥ç”¨ï¼Œå› ä¸ºå½“å‰çš„å®ä¾‹ä¸­<code>this</code>æ˜¯å¯ç”¨çš„ï¼Œå¹¶ä¸”å®¹æ˜“è¢«æ»¥ç”¨ã€‚ React å¼€å‘ç»„å†³å®šåˆ é™¤äº†å®¹æ˜“å‡ºé”™çš„æ–¹æ³•ï¼Œä½¿æ•´ä¸ªReactç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ›´åŠ ç®€å•ã€‚</p><p>ä¸ºäº†æé«˜ååº”çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ï¼Œå›¢é˜Ÿæ­£æœç€å¼‚æ­¥æ¸²æŸ“çš„æ–¹å‘å‘å±•ã€‚ é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•èƒŒåçš„åŠ¨æœºä¸»è¦æ˜¯ä½¿æ–¹æ³•æ›´å®¹æ˜“å’Œå…¼å®¹çš„å¼‚æ­¥æ¸²æŸ“ã€‚</p><p>ä¸‹é¢çš„é“¾æ¥æ˜¯ Dan Abramov åˆ¶ä½œçš„å…³äºå¼‚æ­¥æ¸²æŸ“æ¼”ç¤ºã€‚<br><a href="https://www.youtube.com/watch?v=nLF0n9SACd4" target="_blank" rel="noopener">video link</a></p><p>ä»¥ä¸‹çš„æ–¹æ³•æ˜¯è¢«åºŸå¼ƒçš„:</p><p>1.componentWillMount</p><p>æ‰€æœ‰é—ç•™çš„ä½¿ç”¨åœºæ™¯éƒ½å¯ä»¥è¢«æ„é€ å‡½æ•°è¦†ç›–ï¼Œè¢«é‡å‘½åä¸ºUNSAFE_componentWillMount.</p><p>2.componentWillReceiveProps</p><p>æ–°çš„é™æ€æ–¹æ³• getDerivedStateFromProps å®‰å…¨çš„é‡å†™äº†æ–¹æ³•ï¼Œå¹¶ä¸”æ¶µç›–äº† componentWillReceiveProps çš„æ‰€æœ‰ç”¨ä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•è¢«é‡å‘½åä¸º UNSAFE_componentWillReceivePropsã€‚</p><p>3.componentWillUpdate</p><p>æ–°æ–¹æ³• getSnapshotBeforeUpdate å¯¹æ­¤æ–¹æ³•è¿›è¡Œäº†å®‰å…¨çš„é‡å†™ï¼Œæ¶µç›–äº† componentWillUpdate çš„æ‰€æœ‰ç”¨ä¾‹ã€‚<br>è¯¥æ–¹æ³•è¢«é‡å‘½åä¸º UNSAFE_componentWillUpdateã€‚</p><h2 id="æœ€æ–°-React-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé˜¶æ®µ"><a href="#æœ€æ–°-React-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé˜¶æ®µ" class="headerlink" title="æœ€æ–° React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé˜¶æ®µ"></a>æœ€æ–° React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé˜¶æ®µ</h2><p>ç»§æ‰¿è‡³React.Componentçš„ç»„ä»¶ä¼šä¾æ¬¡ç»å†ä»¥ä¸‹çš„é˜¶æ®µ</p><ul><li>Mountingï¼ˆè£…è½½ï¼‰</li><li>Updating ï¼ˆæ›´æ–°ï¼‰</li><li>Unmounting ï¼ˆå¸è½½ï¼‰</li></ul><p>ä¸‹å›¾ä»£è¡¨äº† React çš„æœ€æ–°ç”Ÿå‘½å‘¨æœŸçš„é˜¶æ®µå’Œæ–¹æ³•ã€‚<br><img src="/img/postImg/lifecycle.png" alt="new-lifecycle-in-react"></p><h3 id="1-è£…è½½ï¼ˆMountingï¼‰"><a href="#1-è£…è½½ï¼ˆMountingï¼‰" class="headerlink" title="1) è£…è½½ï¼ˆMountingï¼‰"></a>1) è£…è½½ï¼ˆMountingï¼‰</h3><p>åœ¨ React é¢†åŸŸä¸­ï¼Œè£…è½½ï¼ˆmountï¼‰æ˜¯æŒ‡çš„æ˜¯åœ¨ DOM ä¸ŠåŠ è½½ç»„ä»¶ã€‚ è¿™ä¸ªé˜¶æ®µåŒ…å«ä¸€ç»„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ä¼šè¢«è°ƒç”¨ï¼Œç„¶ååŠ è½½åˆ° DOMã€‚</p><p>æ–¹æ³•çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š</p><ul><li>constructor</li></ul><p>è¿™æ˜¯æ¯æ¬¡åˆ›å»ºç»„ä»¶æ—¶éƒ½ä¼šè°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ã€‚ æ„é€ å‡½æ•°åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚ å®ƒç”¨äºè®¾ç½®å˜é‡å’Œç»„ä»¶çŠ¶æ€çš„åˆå§‹å€¼ã€‚</p><p>ä½¿ç”¨æ–¹æ³•: è®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContraMusicPlayer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span></span><br><span class="line"><span class="class"><span class="title">constructor</span>(<span class="title">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>(props);</span><br><span class="line">  <span class="keyword">this</span>.state = &#123;</span><br><span class="line">    volume: <span class="number">70</span>,</span><br><span class="line">    status: <span class="string">'pause'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ¸²æŸ“ <code>&lt;ContraMusicPlayer&gt;</code> ç»„ä»¶ï¼Œç»„ä»¶çš„åˆå§‹çŠ¶æ€å°†ä¼šæ˜¯éŸ³é‡70ï¼Œå¤„äºæš‚åœçŠ¶æ€ã€‚</p><p>åœ¨ React é¢†åŸŸï¼Œ construct æ˜¯å”¯ä¸€ä¸€ä¸ª<code>this.state</code>ç›´æ¥ä½¿ç”¨çš„åœ°æ–¹ï¼Œåœ¨å…¶ä»–æ–¹æ³•é‡Œé¢ï¼Œæ›´æ”¹<code>state</code>åªèƒ½ä½¿ç”¨<code>this.setState()</code>.</p><ul><li>static getDerivedStateFromProps</li></ul><p>æ­£å¦‚è¿™ä¸ªåå­—æ‰€å»ºè®®çš„ä¸€æ ·ï¼Œä»props è·å–é©±åŠ¨çŠ¶æ€ï¼Œé€‚ç”¨äºstateæ˜¯ä¾èµ–äºpropsçš„ï¼Œå› æ­¤ï¼Œæ¯å½“propså‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œstateå¿…é¡»ä¿æŒåŒæ­¥ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¹‹åè°ƒç”¨ï¼Œå‡½æ•°çš„è¿”å›å¯¹è±¡ä½œä¸ºæ›´æ–°stateçš„å¯¹è±¡ï¼Œå¦‚æœè¿”å›<code>null</code>,é‚£ä¹ˆstateå°±ä¸ä¼šå‘ç”Ÿæ›´æ–°ã€‚</p><p><code>getDerivedStateFromProps</code>æ˜¯ä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œå› æ­¤å®ƒæ— æ³•è®¿é—®<code>this</code>ã€‚ è¯¥æ–¹æ³•å¯ä»¥è®¿é—®å½“å‰<code>props</code>å’Œ<code>state</code>ã€‚ å› æ­¤ï¼Œå¦‚æœ<code>state</code>ä¾èµ–äº<code>props</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªçŠ¶æ€å°±å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°ã€‚ è¿™ç§æ–¹æ³•æ˜¯ React v16.3+ ä¸­çš„å…¨æ–°æ·»åŠ ã€‚<br>ä½¿ç”¨æ–¹æ³•: ä¿æŒstateä¸ä¼ è¿›æ¥çš„propsä¸€è‡´ã€‚ è¿™ä¸ªæ–¹æ³•æ›´å®‰å…¨åœ°æ›¿æ¢äº† componentWillReceivePropsã€‚ è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå› æ­¤ä¸åº”è¯¥åœ¨è¿™é‡Œå†™ä»»ä½•äº§ç”Ÿå‰¯ä½œç”¨çš„æ–¹æ³•ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼šå‰¯ä½œç”¨å¹¶ä¸æ˜¯reactä¸“æœ‰çš„åè¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°å‡½æ•°è¡Œä¸ºçš„åŸºæœ¬æ¦‚å¿µï¼Œä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„å‡½æ•°æ„å‘³ç€ï¼Œå‡½æ•°å°è¯•æ”¹å˜å½“å‰å‡½æ•°ä½œç”¨åŸŸä»¥å¤–çš„å˜é‡ï¼Œä¾‹å¦‚ï¼Œæ”¹å˜å…¨å±€å˜é‡ã€ç½‘ç»œè¯·æ±‚ç­‰ç­‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class="line">  <span class="keyword">if</span> (state.value !== props.value) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        derivedValue: deriveValueFromProps(props),</span><br><span class="line">        mirroredProp: props.value</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  <span class="comment">// when null is returned no update is made to the state</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// after getDerivedStateFromProps the state looks like as follows:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   &#123;</span></span><br><span class="line"><span class="comment">//    derivedValue: someValue,</span></span><br><span class="line"><span class="comment">//    mirrordValue: newPropValue</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†è·Ÿè¸ªpropså€¼çš„å˜åŒ–ï¼Œpropsçš„å®é™…å€¼åœ¨ä¼šæ˜ å°„ä¸€ä»½åœ¨stateä¸­ï¼Œç”¨æ¥ä¸ä¸‹ä¸€æ¬¡propsä½œæ¯”è¾ƒã€‚</p><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥é¿å…ä½¿ç”¨propsæ¥æ¨å¯¼state <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="noopener">å‚è€ƒè¿™ç¯‡æ–‡ç« </a></p><ul><li>render</li></ul><p>è¿™æ˜¯åœ¨ React ç»„ä»¶ä¸­å¿…éœ€çš„æ–¹æ³•ï¼Œå› ä¸ºè¯¥æ–¹æ³•é¢„å…ˆå‡†å¤‡äº†è£…è½½ç”Ÿæˆæµè§ˆå™¨ä¸­çš„DOMçš„å…ƒç´ ã€‚è¿™æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ„å‘³ç€æ¯æ¬¡æä¾›ç›¸åŒçš„è¾“å…¥éƒ½ä¼šç»™å‡ºç›¸åŒçš„è¾“å‡ºï¼ˆç›¸åŒçš„UIï¼‰ã€‚è¯¥æ–¹æ³•ä¸åº”è¯¥æœ‰ä»»ä½•å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¦‚æ”¹å˜çŠ¶æ€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">     &lt;PlayHeader&gt;</span><br><span class="line">       &lt;Status/&gt;</span><br><span class="line">       &lt;VolumeBar/&gt;</span><br><span class="line">       &lt;SeekBar/&gt;</span><br><span class="line">    &lt;<span class="regexp">/PlayHeader&gt;</span></span><br><span class="line"><span class="regexp">   &lt;/</span>div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>componentDidMount</li></ul><p>The following example shows the setup of Highcharts when the DOM is ready</p><p>è¿™æ˜¯åœ¨ç»„ä»¶æŒ‚è½½åˆ°æµè§ˆå™¨ DOM åç«‹å³è°ƒç”¨çš„ hook æ–¹æ³•ã€‚</p><p>ä½¿ç”¨æ–¹æ³•: æ‰€æœ‰ä¸æµè§ˆå™¨ DOM çš„ç›´æ¥äº¤äº’ï¼Œå¹¶ä¸åƒ Highcharts æˆ– D3è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“é›†æˆã€‚ </p><p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨ DOM ç”Ÿæˆå¥½ä¹‹å Highcharts å®ä¾‹çš„ç”Ÿæˆã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">this</span>.props.modules) &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.modules.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">module</span>(Highcharts);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Set container which the chart should render to.</span></span><br><span class="line">        <span class="keyword">this</span>.chart = <span class="keyword">new</span> Highcharts[<span class="keyword">this</span>.props.type || <span class="string">"Chart"</span>](</span><br><span class="line">            <span class="keyword">this</span>.props.container, </span><br><span class="line">            <span class="keyword">this</span>.props.options</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ›´æ–°ï¼ˆUpdatingï¼‰"><a href="#2-æ›´æ–°ï¼ˆUpdatingï¼‰" class="headerlink" title="2) æ›´æ–°ï¼ˆUpdatingï¼‰"></a>2) æ›´æ–°ï¼ˆUpdatingï¼‰</h3><p>å½“ React ç»„ä»¶åœ¨æµè§ˆå™¨ä¸Šè£…è½½å¹¶é€šè¿‡æ¥æ”¶æ–°çš„æ›´æ–°æ¥æ›´æ–°ç»„ä»¶æ—¶ï¼Œè¿™ä¸ªé˜¶æ®µå°±å¼€å§‹äº†ã€‚ ç»„ä»¶å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œæ›´æ–°ï¼Œæ¥æ”¶ä»çˆ¶æ¯é‚£é‡Œå‘é€æ–°çš„propsæˆ–è€…æ›´æ–°å½“å‰stateã€‚</p><p>å½“æ›´æ–°ä»¥ä»»ä½•æ–¹å¼å‘ç”Ÿæ—¶ï¼Œå°†æŒ‰é¡ºåºè°ƒç”¨çš„æ–¹æ³•åˆ—è¡¨:</p><ul><li>static getDerivedStateFromProps</li></ul><p>This method behaves exactly as defined above in mounting phase.<br>è¿™ä¸ªæ–¹æ³•å¾—è¡Œä¸ºå’Œä¹‹å‰åœ¨è£…è½½é˜¶æ®µæè¿°çš„å®Œå…¨ä¸€è‡´</p><ul><li>shouldComponentUpdate</li></ul><p>è¿™ä¸ªæ–¹æ³•å‘Šè¯‰ Reactï¼Œå½“ç»„ä»¶æ­£åœ¨æ›´æ–°æ—¶ï¼Œå®ƒåº”è¯¥é‡æ–°æ¸²æŸ“è¿˜æ˜¯è·³è¿‡æ¸²æŸ“ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯é€‰æ‹©ï¼ˆåŸæ–‡:a questionï¼‰ï¼Œæ˜¯å¦åº”è¯¥æ›´æ–°ç»„ä»¶ï¼Ÿå› æ­¤ï¼Œæ­¤æ–¹æ³•åº”è¿”å› true æˆ– falseï¼Œå› æ­¤ï¼Œç»„ä»¶å°†è¢«é‡æ–°æ¸²æŸ“æˆ–è·³è¿‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–¹æ³•è¿”å› trueã€‚</p><p>ä½¿ç”¨æ–¹æ³•: æœ¬ä¾‹æ˜¯æ¸²æŸ“æˆæœ¬ç›¸å½“é«˜çš„æƒ…å†µä¹‹ä¸€ï¼Œæˆ‘ä»¬å¸Œæœ›åªåœ¨propsçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">  <span class="keyword">let</span> shouldUpdate = <span class="keyword">this</span>.props.status !== nextProps.status;</span><br><span class="line">  <span class="keyword">return</span> shouldUpdate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå‡è®¾å¯¹äºæ¯ä¸ªæ¸²æŸ“ï¼Œç»„ä»¶ç”Ÿæˆä¸€åƒä¸ªç´ æ•°ã€‚ å¦‚æœæŸäº›åº”ç”¨æœ‰è¿™ç§é€»è¾‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ä»€ä¹ˆæ—¶å€™éœ€è¦å®ƒï¼Œå¹¶ç¡®ä¿ç»„ä»¶è¢«æ¸²æŸ“ã€‚</p><p>ç„¶åå°†ç»„ä»¶å‘ˆç°å‡ºæ¥(ç»†èŠ‚åœ¨è£…è½½é˜¶æ®µ)ã€‚</p><ul><li>getSnapshotBeforeUpdate</li></ul><p>è¿™ä¸ªæ–¹æ³•åœ¨æ¸²æŸ“åˆ›å»ºäº† React å…ƒç´ ä¹‹åè¢«è°ƒç”¨ï¼Œåœ¨å®ƒä»è™šæ‹Ÿ DOM æ›´æ–°åˆ°å®é™… DOM ä¹‹å‰ã€‚ è¿™ä¸ªé˜¶æ®µç§°ä¸ºé¢„æäº¤(<code>pre-commit</code>)é˜¶æ®µã€‚</p><p>è¿™ç§æ–¹æ³•å¯ä»¥è®¿é—®ä»¥å‰å’Œå½“å‰çš„propså’Œstateã€‚</p><p>å¦‚æœæ–¹æ³• snapshotbeforeupdate è¿”å›ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆ componentDidUpdate ç¬¬ä¸‰ä¸ªå‚æ•°ä¼šè·å¾—è¿™ä¸ªå€¼ï¼ˆ<code>componentDidUpdate(prevProps, prevState, snapshot)</code>ï¼‰ï¼Œé‚£ä¹ˆ UI å°±å¯ä»¥åœ¨æ¸²æŸ“ä¹‹å‰å’Œä¹‹åè¿›è¡ŒåŒæ­¥ã€‚</p><p>ä½¿ç”¨æ–¹æ³•: å¦‚æœæ‚¨å¸Œæœ›åœ¨å½“å‰ DOM çš„ state ä¸æ›´æ–°çš„ DOM ä¹‹é—´ä¿æŒåŒæ­¥ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸æœ‰ç”¨ã€‚ ä¾‹å¦‚æ»šåŠ¨ä½ç½®ã€éŸ³é¢‘ / è§†é¢‘ã€æ–‡å­—é€‰æ‹©ã€å…‰æ ‡ä½ç½®ã€tooltipä½ç½®ç­‰ç­‰ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Snapshot = <span class="built_in">number</span> | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ScrollingList <span class="keyword">extends</span> React.Component&lt;Props, State, Snapshot&gt; &#123;</span><br><span class="line">  listRef = React.createRef();</span><br><span class="line"></span><br><span class="line">  getSnapshotBeforeUpdate(</span><br><span class="line">    prevProps: Props,</span><br><span class="line">    prevState: State</span><br><span class="line">  ): Snapshot &#123;</span><br><span class="line">    <span class="comment">// Are we adding new items to the list?</span></span><br><span class="line">    <span class="comment">// Capture the current height of the list so we can adjust scroll later.</span></span><br><span class="line">    <span class="keyword">if</span> (prevProps.list.length &lt; <span class="keyword">this</span>.props.list.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.listRef.value.scrollHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(</span><br><span class="line">    prevProps: Props,</span><br><span class="line">    prevState: State,</span><br><span class="line">    snapshot: Snapshot</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// If we have a snapshot value, then we've just added new items.</span></span><br><span class="line">    <span class="comment">// Adjust scroll so these new items don't push the old ones out of view.</span></span><br><span class="line">    <span class="keyword">if</span> (snapshot !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.listRef.value.scrollTop +=</span><br><span class="line">        <span class="keyword">this</span>.listRef.value.scrollHeight - snapshot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div ref=&#123;<span class="keyword">this</span>.listRef&#125;&gt;&#123;<span class="comment">/* ...contents... */</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>æƒ³äº†è§£æ›´å¤šå¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a href="https://github.com/reactjs/rfcs/blob/master/text/0033-new-commit-phase-lifecycles.md#basic-example" target="_blank" rel="noopener">é“¾æ¥</a>.</p><ul><li>componentDidUpdate</li></ul><p>å½“æ–°æ›´æ–°çš„ç»„ä»¶åœ¨ DOM ä¸­æ›´æ–°æ—¶ï¼Œå°†æ‰§è¡Œ componentDidUpdate ï¼Œè¯¥æ–¹æ³•ç”¨äºé‡æ–°è§¦å‘ç¬¬ä¸‰æ–¹åº“çš„ä½¿ç”¨ï¼Œå¹¶ç¡®ä¿è¿™äº›åº“ä¹Ÿæ›´æ–°å’Œé‡æ–°åŠ è½½è‡ªå·±ã€‚</p><p>ç”¨æ³•: ç”¨ä¾‹å¤§å¤šä¸ componentDidMount çš„ç”¨ä¾‹ç›¸ä¼¼ï¼Œä»¥ä¿æŒç¬¬ä¸‰æ–¹åº“æˆ–ç”¨æˆ·ç•Œé¢ä¸æ¯æ¬¡æ›´æ–°åŒæ­¥ã€‚</p><h3 id="3-å¸è½½ï¼ˆUnmountingï¼‰"><a href="#3-å¸è½½ï¼ˆUnmountingï¼‰" class="headerlink" title="3) å¸è½½ï¼ˆUnmountingï¼‰"></a>3) å¸è½½ï¼ˆUnmountingï¼‰</h3><p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç»„ä»¶å°†ä¸å†è¢«éœ€è¦ï¼Œç»„ä»¶å°†ä» DOM ä¸­å¸è½½ã€‚</p><p>ä¸‹é¢æ˜¯è¿™ä¸ªé˜¶æ®µè°ƒç”¨çš„æ–¹æ³•:</p><ul><li>componentWillUnmount è¿™ä¸ªæ–¹æ³•æ˜¯ç”Ÿå‘½å‘¨æœŸçš„æœ€åæ–¹æ³•ã€‚ è¿™æ˜¯åœ¨ç»„ä»¶ä» DOM ä¸­ç§»é™¤ä¹‹å‰æ‰§è¡Œçš„ã€‚</li></ul><p>ä½¿ç”¨æ–¹æ³•: åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åšä¸ç»„ä»¶ç›¸å…³çš„æ‰€æœ‰æ¸…ç†åŠ¨ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ç™»å‡ºçš„æ—¶å€™ï¼Œç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å’Œæ‰€æœ‰æƒé™tokenå¯ä»¥åœ¨å¸è½½ä¸»è¦ç»„ä»¶ä¹‹å‰è¢«æ¸…é™¤ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentWillUnmount() &#123;</span><br><span class="line"><span class="keyword">this</span>.chart.destroy();</span><br><span class="line"><span class="keyword">this</span>.resetLocalStorage();</span><br><span class="line"><span class="keyword">this</span>.clearSession();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“:)"></a>æ€»ç»“:)</h2><p>ç†è§£ React çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æœ‰åŠ©äºæˆ‘ä»¬åœ¨æ„å»º React ç»„ä»¶å’Œåº”ç”¨ç¨‹åºæ—¶äº§ç”Ÿæœ€å¥½çš„ç»“æœã€‚ äº†è§£å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¦‚ä½•ä½¿ç”¨å®ƒä»¬å¯ä»¥æé«˜æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¿æŒæ›´æ–°å’Œå……åˆ†åˆ©ç”¨ React 16.4+ ã€‚ğŸ‘</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç†è§£-React-v16-4-çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;a href=&quot;#ç†è§£-React-v16-4-çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ&quot; class=&quot;headerlink&quot; title=&quot;ç†è§£ React v16.4+ çš„æ–°çš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;/a&gt;ç†è§£ React v16.4+ çš„æ–°çš„
      
    
    </summary>
    
    
      <category term="Translation" scheme="http://yoursite.com/tags/Translation/"/>
    
      <category term="React" scheme="http://yoursite.com/tags/React/"/>
    
  </entry>
  
</feed>
